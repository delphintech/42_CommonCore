http {
    backlog=1024;
    # 30s, 100 iterations
    so_keepalive=30000:100; 
    rcvbuf=819200;
    sndbuf=302573;
    #tmp dir
    tmp_dir=/tmp/webserv/;
    send_timeout=5;
}
server {
	listen 4243;
	host 127.0.0.1;
	server_name test www.test.com;
	error_page 404 /errorpages/404.html;
	root ./www/;    # Chemin relatif au dossier d'execution du serveur ex: /home/webser/var/
	index index.html;

	# Ajouter des en-têtes HTTP pour toutes les réponses du serveur
    add_header Access-Control-Allow-Origin *; # Permettre à tous les domaines d'accéder à la ressource
	add_header Access-Control-Allow-Headers Content-Type; # Permettre le type de contenu
	add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS; # Méthodes autorisées
    add_header Access-Control-Max-Age 86400; # Temps de mise en cache cote client (en secondes), c'est gere par le navigateur
	location /testHTTP {
		root ./unsousdossierpourlestests;           # root of the location. taken from the server as default
		auto_index on;                   # directory listing
		allow_methods GET HEAD;         # allowed methods in location
		index testHttp.html;               # default page when requesting a directory, copies root index by default
	}
	location /uploads {  
		root www;
		auto_index on;                   # directory listing
		allow_methods GET DELETE POST PUT HEAD;         # allowed methods in location
	}
		location /js {                   
		root ./assets;           # root of the location. taken from the server as default
		auto_index on;                   # directory listing
		allow_methods GET HEAD;         # allowed methods in location
		index testHTTP.js;               # default page when requesting a directory, copies root index by default
	}
	location /favicon.ico {                   
		root ./assets/images;
		allow_methods GET;
	}
	location /style {                   
		root ./assets;
		allow_methods GET;
	}

	location /cgi-bin {
		allow_methods POST GET HEAD;     # allowed methods in location
		root www;                                                 # cgi-bin location, mandatory parameter
		cgi_path /usr/bin/php-cgi /bin/bash;                     # location of interpreters installed on the current system, mandatory parameter
		cgi_ext .php .sh;                                         # extensions for executable files, mandatory parameter
		upload_store ./cgi-bin/tmp/uploads1;							  # directory for storing temporary files
	}

	location /redirectionversuploads {
		allow_methods POST GET HEAD;		
		return 301 http://127.0.0.1:4243/uploads;		 # redirection
	}

	# Location pour les fichiers image
    location ~* \.(jpeg|gif|ico)$ {
        root ./assets/images;  # Chemin absolu pour les fichiers image
        autoindex off;  # Désactiver l'affichage du listing des répertoires
        allow_methods GET;  # Méthodes autorisées dans cette location
    }
	location ~* \.(php) {
		allow_methods POST GET HEAD PUT;     # allowed methods in location
		cgi_path /usr/bin/php-cgi /bin/bash;
		cgi_ext .php .sh;
		upload_store ./uploadscgi;
    }
}

server {
	listen 4243;
	host 127.0.0.1;
	server_name test2 www.test2.com;
	error_page 404 /errorpages/404.html;
	root ./www/;    # Chemin relatif au dossier d'execution du serveur ex: /home/webser/var/
	index index.html;

	# Ajouter des en-têtes HTTP pour toutes les réponses du serveur
    add_header Access-Control-Allow-Origin *; # Permettre à tous les domaines d'accéder à la ressource
	add_header Access-Control-Allow-Headers Content-Type; # Permettre le type de contenu
	add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS; # Méthodes autorisées
    add_header Access-Control-Max-Age 86400; # Temps de mise en cache cote client (en secondes), c'est gere par le navigateur
	location /testHTTP {
		root ./unsousdossierpourlestests;           # root of the location. taken from the server as default
		auto_index on;                   # directory listing
		allow_methods GET HEAD;         # allowed methods in location
		index testHttp.html;               # default page when requesting a directory, copies root index by default
	}
	location /uploads {  
		root www;
		auto_index on;                   # directory listing
		allow_methods GET;         # allowed methods in location
	}
		location /js {                   
		root ./assets;           # root of the location. taken from the server as default
		auto_index on;                   # directory listing
		allow_methods GET HEAD;         # allowed methods in location
		index testHTTP.js;               # default page when requesting a directory, copies root index by default
	}
	location /favicon.ico {                   
		root ./assets/images;
		allow_methods GET;
	}
	location /style {                   
		root ./assets;
		allow_methods GET;
	}

	location /cgi-bin {
		allow_methods POST GET HEAD;     # allowed methods in location
		root www;                                                 # cgi-bin location, mandatory parameter
		cgi_path /usr/bin/php-cgi /bin/bash;                     # location of interpreters installed on the current system, mandatory parameter
		cgi_ext .php .sh;                                         # extensions for executable files, mandatory parameter
		upload_store ./cgi-bin/tmp/uploads1;							  # directory for storing temporary files
	}

	location /redirectionversuploads {
		allow_methods POST GET HEAD;		
		return 301 http://127.0.0.1:4243/uploads;		 # redirection
	}

	# Location pour les fichiers image
    location ~* \.(jpeg|gif|ico)$ {
        root ./assets/images;  # Chemin absolu pour les fichiers image
        autoindex off;  # Désactiver l'affichage du listing des répertoires
        allow_methods GET;  # Méthodes autorisées dans cette location
    }
	location ~* \.(php) {
		allow_methods POST GET HEAD PUT;     # allowed methods in location
		cgi_path /usr/bin/php-cgi /bin/bash;
		cgi_ext .php .sh;
		upload_store ./uploadscgi;
    }
}
server {
	listen 2345;
	host 127.0.0.1;
	#server_name test www.test.com;
	error_page 404 /errorpages/404.html;
	client_max_body_size 1024;
	root ./var/html/domain1;    # Chemin relatif au dossier d'execution du serveur ex: /home/webser/var/
	index index.html;
 	
	add_header Access-Control-Allow-Origin *; # Permettre à tous les domaines d'accéder à la ressource
	add_header Access-Control-Allow-Headers Content-Type; # Permettre le type de contenu
	add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS; # Méthodes autorisées
	add_header Access-Control-Max-Age 86400; # Temps de mise en cache cote client (en secondes), c'est gere par le navigateur
	
	location /{
		auto_index on;                   # directory listing
		allow_methods POST GET HEAD;     # allowed methods in location		
	}
	location /errorpages{
		auto_index off;                   # directory listing
		allow_methods GET;     # allowed methods in location
		root var;
	}

	location /test {                   
		root docs/fusion_web;           # root of the location. taken from the server as default
		auto_index on;                   # directory listing
		allow_methods POST GET;         # allowed methods in location
		index index.html;               # default page when requesting a directory, copies root index by default
		return abc/index1.html;         # redirection
		alias  docs/fusion_web;         # replaces location part of URI. 
										# EX: - URI /tours           --> docs/fusion_web
										#     - URI /tours/page.html --> docs/fusion_web/page.html 
	}

	location cgi-bin {
		root ./;                                                 # cgi-bin location, mandatory parameter
		cgi_path /usr/bin/python3 /bin/bash;                     # location of interpreters installed on the current system, mandatory parameter
		cgi_ext .py .sh;                                         # extensions for executable files, mandatory parameter
		upload_store /tmp/uploads;							  # directory for storing temporary files
	}
}